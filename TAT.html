<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task Entry Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
  body {
    background: #f4f6f8;
    font-family: 'Segoe UI', sans-serif;
  }
  .container {
    max-width: 900px;
    margin-top: 40px;
  }
  .form-section {
    background: white;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease-in-out;
  }
  .form-control:focus {
    box-shadow: 0 0 5px rgba(0,123,255,0.5);
    border-color: #80bdff;
  }
  .table-section {
    margin-top: 30px;
  }
  .table thead th {
    background-color: #343a40;
    color: white;
    text-align: center;
  }
  .table tbody tr:hover {
    background-color: #f1f1f1;
    transition: background-color 0.2s ease-in-out;
  }
  .action-btns button {
    margin-right: 5px;
    transition: all 0.2s ease-in-out;
  }
  .action-btns button:hover {
    transform: scale(1.05);
  }
  .pagination-controls {
    display: flex;
    justify-content: center;
    margin-top: 15px;
  }
  .fade-in {
    animation: fadeIn 0.5s ease-in-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }
</style>

</head>
<body>

<div class="container">
  <h2 class="text-center mb-4">Task Entry Panel</h2>

  <div class="form-section">
    <form id="taskForm">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="dateInput" class="form-label">Date</label>
          <input type="date" id="dateInput" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label for="typeInput" class="form-label">Type of Rate</label>
          <input type="text" id="typeInput" class="form-control" placeholder="Enter type" required>
        </div>
        <div class="col-md-4">
          <label for="tatInput" class="form-label">TAT (in minutes)</label>
          <input type="number" id="tatInput" class="form-control" placeholder="Time taken" required min="0">
        </div>
      </div>
      <div class="mt-4 d-flex justify-content-between">
        <button type="submit" class="btn btn-primary">Add Entry</button>
        <button type="button" class="btn btn-success" onclick="exportTableToCSV()">Export to CSV</button>
      </div>
    </form>
  </div>

  <div class="table-section">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Submitted Data</h5>
      <input type="text" class="form-control w-50" id="searchInput" placeholder="Search by Type or Date">
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped" id="dataTable">
        <thead class="table-dark">
          <tr>
            <th>Date</th>
            <th>Type of Rate</th>
            <th>TAT (min)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table rows will be added here -->
        </tbody>
      </table>
    </div>

    <div class="pagination-controls">
      <button class="btn btn-secondary me-2" onclick="prevPage()">Prev</button>
      <span id="pageIndicator" class="mt-2"></span>
      <button class="btn btn-secondary ms-2" onclick="nextPage()">Next</button>
    </div>

    <div class="mt-4 bg-light p-3 rounded">
      <h6>Total TAT Summary</h6>
      <p><strong>This Week:</strong> <span id="weeklyTotal">0</span> minutes</p>
      <p><strong>This Month:</strong> <span id="monthlyTotal">0</span> minutes</p>
    </div>
  </div>
</div>


<script>
  const form = document.getElementById('taskForm');
  const tableBody = document.querySelector('#dataTable tbody');
  const searchInput = document.getElementById('searchInput');
  const pageIndicator = document.getElementById('pageIndicator');
  let editingRowIndex = null;
  let taskData = JSON.parse(localStorage.getItem('taskData')) || [];
  let currentPage = 1;
  const rowsPerPage = 30;

  function saveData() {
    localStorage.setItem('taskData', JSON.stringify(taskData));
  }

  function filterData(data) {
    const query = searchInput.value.toLowerCase();
    return data.filter(item =>
      item.type.toLowerCase().includes(query) ||
      item.date.toLowerCase().includes(query)
    );
  }

  function renderTable(data = taskData) {
    data.sort((a, b) => new Date(b.date) - new Date(a.date));
    const filteredData = filterData(data);
    const start = (currentPage - 1) * rowsPerPage;
    const paginated = filteredData.slice(start, start + rowsPerPage);

    tableBody.innerHTML = '';
    paginated.forEach((entry, index) => {
      const realIndex = taskData.indexOf(entry);
      const row = document.createElement('tr');
      row.classList.add('fade-in');
      row.innerHTML = `
        <td>${entry.date}</td>
        <td>${entry.type}</td>
        <td>${entry.tat}</td>
        <td class="action-btns">
          <button class="btn btn-sm btn-warning" onclick="editRow(${realIndex})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteRow(${realIndex})">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    const totalPages = Math.ceil(filteredData.length / rowsPerPage);
    pageIndicator.innerText = `Page ${currentPage} of ${totalPages || 1}`;
    updateTATTotals();
  }

  function editRow(index) {
    const entry = taskData[index];
    document.getElementById('dateInput').value = entry.date;
    document.getElementById('typeInput').value = entry.type;
    document.getElementById('tatInput').value = entry.tat;
    editingRowIndex = index;
  }

  function deleteRow(index) {
    if (confirm("Are you sure you want to delete this entry?")) {
      taskData.splice(index, 1);
      saveData();
      showToast('Entry deleted!', 'danger');

      if ((currentPage - 1) * rowsPerPage >= taskData.length) {
        currentPage = Math.max(1, currentPage - 1);
      }
      renderTable();
    }
  }

  function prevPage() {
    if (currentPage > 1) {
      currentPage--;
      renderTable();
    }
  }

  function nextPage() {
    const totalFiltered = filterData(taskData).length;
    const totalPages = Math.ceil(totalFiltered / rowsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      renderTable();
    }
  }

  function exportTableToCSV() {
    let csvContent = "Date,Type of Rate,TAT (minutes)\n";
    taskData.forEach(row => {
      csvContent += `${row.date},${row.type},${row.tat}\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "task_data.csv";
    a.click();
  }

  function updateTATTotals() {
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    let weeklyTotal = 0;
    let monthlyTotal = 0;

    taskData.forEach(item => {
      const entryDate = new Date(item.date);
      const tat = parseFloat(item.tat);
      if (!isNaN(tat)) {
        const timeDiff = (now - entryDate) / (1000 * 60 * 60 * 24);
        if (timeDiff <= 7 && timeDiff >= 0) {
          weeklyTotal += tat;
        }
        if (
          entryDate.getMonth() === currentMonth &&
          entryDate.getFullYear() === currentYear
        ) {
          monthlyTotal += tat;
        }
      }
    });

    document.getElementById('weeklyTotal').textContent = weeklyTotal;
    document.getElementById('monthlyTotal').textContent = monthlyTotal;
  }

  function showToast(message, type = 'success') {
    const toastEl = document.getElementById('liveToast');
    const toastBody = document.getElementById('toastMessage');

    toastBody.innerText = message;
    toastEl.classList.remove('bg-success', 'bg-danger', 'bg-warning');
    toastEl.classList.add(`bg-${type}`);

    const toast = new bootstrap.Toast(toastEl);
    toast.show();
  }

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const date = document.getElementById('dateInput').value;
    const type = document.getElementById('typeInput').value.trim();
    const tat = document.getElementById('tatInput').value;

    if (!date || !type || tat < 0) return;

    const entry = { date, type, tat };

    if (editingRowIndex !== null) {
      taskData[editingRowIndex] = entry;
      editingRowIndex = null;
      showToast('Entry updated!', 'warning');
    } else {
      taskData.push(entry);
      showToast('Entry added!', 'success');
    }

    saveData();
    form.reset();
    currentPage = Math.ceil(filterData(taskData).length / rowsPerPage);
    renderTable();
  });

  searchInput.addEventListener('input', () => {
    currentPage = 1;
    renderTable();
  });

  renderTable();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<!-- Bootstrap Toast Alert UI -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050">
  <div id="liveToast" class="toast align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastMessage">Entry added!</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

</body>
</html>
